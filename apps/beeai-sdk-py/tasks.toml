# setup

["beeai-sdk-py:setup"]
dir = "{{config_root}}/apps/beeai-sdk-py"
run = "uv sync --all-extras --dev"
sources = ["uv.lock", "pyproject.toml"]
outputs = { auto = true }

# check

["beeai-sdk-py:check"]
depends = ["beeai-sdk-py:check:*"]

["beeai-sdk-py:check:ruff-check"]
depends = ["beeai-sdk-py:setup"]
dir = "{{config_root}}/apps/beeai-sdk-py"
run = "uv run python -m ruff check --quiet"
sources = ["src/**/*.py"]
outputs = { auto = true }

["beeai-sdk-py:check:ruff-format"]
depends = ["beeai-sdk-py:setup"]
dir = "{{config_root}}/apps/beeai-sdk-py"
run = "uv run python -m ruff format --quiet --check"
sources = ["src/**/*.py"]
outputs = { auto = true }

["beeai-sdk-py:check:pyright"]
dir = "{{config_root}}/apps/beeai-sdk-py"
run = "uv run python -m pyright"
sources = ["src/**/*.py"]
outputs = { auto = true }


["beeai-sdk-py:check:pytest-marks"]
depends = ["beeai-sdk-py:setup"]
dir = "{{config_root}}/apps/beeai-sdk-py"
run = """
#!/bin/bash

# Use pytest to collect tests that are not marked with unit, integration, or e2e
unmarked_tests=$(uv run pytest --collect-only --no-header --no-summary -q -m "not (unit or integration or e2e)" tests/ 2>/dev/null)

if echo "$unmarked_tests" | grep "tests collected" | grep -qv "no tests collected"; then
    echo "ERROR: Found tests without required pytest marks:\n"
    echo "$unmarked_tests" | grep 'tests collected'
    echo ""
    echo "All tests must be marked with @pytest.mark.unit, @pytest.mark.integration, or @pytest.mark.e2e"
    exit 1
else
    echo "âœ“ All tests have pytest marks"
fi
"""
sources = ["tests/**/*.py"]
outputs = { auto = true }

# fix

["beeai-sdk-py:fix"]
depends = ["beeai-sdk-py:fix:*"]

["beeai-sdk-py:fix:ruff-check"]
depends = ["beeai-sdk-py:setup"]
dir = "{{config_root}}/apps/beeai-sdk-py"
run = "uv run python -m ruff check --quiet --fix"
sources = ["src/**/*.py"]
outputs = { auto = true }

["beeai-sdk-py:fix:ruff-format"]
depends = ["beeai-sdk-py:setup"]
dir = "{{config_root}}/apps/beeai-sdk-py"
run = "uv run python -m ruff format --quiet"
sources = ["src/**/*.py"]
outputs = { auto = true }

# test

["beeai-sdk-py:e2e-test"]
depends = ["beeai-sdk-py:setup"]
dir = "{{config_root}}/apps/beeai-sdk-py"
run = "uv run pytest"

# build

["beeai-sdk-py:build"]
depends = ["beeai-sdk-py:setup"]
dir = "{{config_root}}/apps/beeai-sdk-py"
run = "rm ./dist/* 2>/dev/null || true; uv build --out-dir dist"
sources = ["pyproject.toml", "uv.lock", "src/**/*.py"]
outputs = ["dist/*"]
